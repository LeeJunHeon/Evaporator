# -*- coding: utf-8 -*-

################################################################################
## Form generated from reading UI file 'EvaporatoriTdLHg.ui'
##
## Created by: Qt User Interface Compiler version 6.9.1
##
## WARNING! All changes made in this file will be lost when recompiling UI file!
################################################################################

from PySide6.QtCore import (QCoreApplication, QDate, QDateTime, QLocale,
    QMetaObject, QObject, QPoint, QRect,
    QSize, QTime, QUrl, Qt, QTimer)
from PySide6.QtGui import (QBrush, QColor, QConicalGradient, QCursor,
    QFont, QFontDatabase, QGradient, QIcon,
    QImage, QKeySequence, QLinearGradient, QPainter,
    QPalette, QPixmap, QRadialGradient, QTransform)
from PySide6.QtWidgets import (QApplication, QFrame, QLabel, QLineEdit,
    QPushButton, QSizePolicy, QStackedWidget, QWidget)

class Ui_Form(object):
    def setupUi(self, Form):
        if not Form.objectName():
            Form.setObjectName(u"Form")
        Form.resize(1149, 703)
        Form.setAutoFillBackground(True)
        self.stackedWidget = QStackedWidget(Form)
        self.stackedWidget.setObjectName(u"stackedWidget")
        self.stackedWidget.setGeometry(QRect(0, 0, 1151, 701))
        self.page = QWidget()
        self.page.setObjectName(u"page")

        self.frame_19 = QFrame(self.page)
        self.frame_19.setObjectName(u"frame_19")
        self.frame_19.setGeometry(QRect(1070, 340, 16, 191))
        self.frame_19.setAutoFillBackground(True)
        self.frame_19.setFrameShape(QFrame.Shape.StyledPanel)
        self.frame_19.setFrameShadow(QFrame.Shadow.Raised)

        self.pushButton_13 = QPushButton(self.page)
        self.pushButton_13.setObjectName(u"pushButton_13")
        self.pushButton_13.setGeometry(QRect(780, 370, 101, 71))

        self.frame_7 = QFrame(self.page)
        self.frame_7.setObjectName(u"frame_7")
        self.frame_7.setGeometry(QRect(140, 340, 71, 16))
        self.frame_7.setAutoFillBackground(True)
        self.frame_7.setFrameShape(QFrame.Shape.StyledPanel)
        self.frame_7.setFrameShadow(QFrame.Shadow.Raised)

        self.frame_9 = QFrame(self.page)
        self.frame_9.setObjectName(u"frame_9")
        self.frame_9.setGeometry(QRect(210, 410, 16, 141))
        self.frame_9.setAutoFillBackground(True)
        self.frame_9.setFrameShape(QFrame.Shape.StyledPanel)
        self.frame_9.setFrameShadow(QFrame.Shadow.Raised)

        self.frame_8 = QFrame(self.page)
        self.frame_8.setObjectName(u"frame_8")
        self.frame_8.setGeometry(QRect(420, 400, 16, 141))
        self.frame_8.setAutoFillBackground(True)
        self.frame_8.setFrameShape(QFrame.Shape.StyledPanel)
        self.frame_8.setFrameShadow(QFrame.Shadow.Raised)

        self.ms2powerBtn = QPushButton(self.page)
        self.ms2powerBtn.setObjectName(u"ms2powerBtn")
        self.ms2powerBtn.setGeometry(QRect(480, 500, 101, 71))

        self.ftmBtn = QPushButton(self.page)
        self.ftmBtn.setObjectName(u"ftmBtn")
        self.ftmBtn.setGeometry(QRect(270, 60, 101, 71))

        self.rpBtn = QPushButton(self.page)
        self.rpBtn.setObjectName(u"rpBtn")
        self.rpBtn.setGeometry(QRect(780, 480, 101, 71))

        self.frame_13 = QFrame(self.page)
        self.frame_13.setObjectName(u"frame_13")
        self.frame_13.setGeometry(QRect(630, 400, 401, 16))
        self.frame_13.setAutoFillBackground(True)
        self.frame_13.setFrameShape(QFrame.Shape.StyledPanel)
        self.frame_13.setFrameShadow(QFrame.Shadow.Raised)

        self.mvBtn = QPushButton(self.page)
        self.mvBtn.setObjectName(u"mvBtn")
        self.mvBtn.setGeometry(QRect(640, 370, 101, 71))

        self.widget = QWidget(self.page)
        self.widget.setObjectName(u"widget")
        self.widget.setGeometry(QRect(190, 160, 261, 261))
        self.widget.setAutoFillBackground(True)

        self.frame_2 = QFrame(self.page)
        self.frame_2.setObjectName(u"frame_2")
        self.frame_2.setGeometry(QRect(150, 630, 120, 16))
        self.frame_2.setAutoFillBackground(True)
        self.frame_2.setFrameShape(QFrame.Shape.StyledPanel)
        self.frame_2.setFrameShadow(QFrame.Shadow.Raised)

        self.frame_6 = QFrame(self.page)
        self.frame_6.setObjectName(u"frame_6")
        self.frame_6.setGeometry(QRect(370, 410, 16, 231))
        self.frame_6.setAutoFillBackground(True)
        self.frame_6.setFrameShape(QFrame.Shape.StyledPanel)
        self.frame_6.setFrameShadow(QFrame.Shadow.Raised)

        self.frame_16 = QFrame(self.page)
        self.frame_16.setObjectName(u"frame_16")
        self.frame_16.setGeometry(QRect(1010, 290, 16, 121))
        self.frame_16.setAutoFillBackground(True)
        self.frame_16.setFrameShape(QFrame.Shape.StyledPanel)
        self.frame_16.setFrameShadow(QFrame.Shadow.Raised)

        self.frame_4 = QFrame(self.page)
        self.frame_4.setObjectName(u"frame_4")
        self.frame_4.setGeometry(QRect(370, 630, 120, 16))
        self.frame_4.setAutoFillBackground(True)
        self.frame_4.setFrameShape(QFrame.Shape.StyledPanel)
        self.frame_4.setFrameShadow(QFrame.Shadow.Raised)

        self.frame_3 = QFrame(self.page)
        self.frame_3.setObjectName(u"frame_3")
        self.frame_3.setGeometry(QRect(420, 530, 71, 16))
        self.frame_3.setAutoFillBackground(True)
        self.frame_3.setFrameShape(QFrame.Shape.StyledPanel)
        self.frame_3.setFrameShadow(QFrame.Shadow.Raised)

        self.fvBtn = QPushButton(self.page)
        self.fvBtn.setObjectName(u"fvBtn")
        self.fvBtn.setGeometry(QRect(920, 370, 101, 71))

        self.frame_5 = QFrame(self.page)
        self.frame_5.setObjectName(u"frame_5")
        self.frame_5.setGeometry(QRect(260, 415, 16, 231))
        self.frame_5.setAutoFillBackground(True)
        self.frame_5.setFrameShape(QFrame.Shape.StyledPanel)
        self.frame_5.setFrameShadow(QFrame.Shadow.Raised)

        self.frame_10 = QFrame(self.page)
        self.frame_10.setObjectName(u"frame_10")
        self.frame_10.setGeometry(QRect(140, 230, 71, 16))
        self.frame_10.setAutoFillBackground(True)
        self.frame_10.setFrameShape(QFrame.Shape.StyledPanel)
        self.frame_10.setFrameShadow(QFrame.Shadow.Raised)

        self.processBtn = QPushButton(self.page)
        self.processBtn.setObjectName(u"processBtn")
        self.processBtn.setGeometry(QRect(60, 20, 101, 71))

        self.frame_18 = QFrame(self.page)
        self.frame_18.setObjectName(u"frame_18")
        self.frame_18.setGeometry(QRect(860, 510, 231, 16))
        self.frame_18.setAutoFillBackground(True)
        self.frame_18.setFrameShape(QFrame.Shape.StyledPanel)
        self.frame_18.setFrameShadow(QFrame.Shadow.Raised)

        self.frame_14 = QFrame(self.page)
        self.frame_14.setObjectName(u"frame_14")
        self.frame_14.setGeometry(QRect(630, 290, 401, 16))
        self.frame_14.setAutoFillBackground(True)
        self.frame_14.setFrameShape(QFrame.Shape.StyledPanel)
        self.frame_14.setFrameShadow(QFrame.Shadow.Raised)

        self.frame_11 = QFrame(self.page)
        self.frame_11.setObjectName(u"frame_11")
        self.frame_11.setGeometry(QRect(430, 230, 71, 16))
        self.frame_11.setAutoFillBackground(True)
        self.frame_11.setFrameShape(QFrame.Shape.StyledPanel)
        self.frame_11.setFrameShadow(QFrame.Shadow.Raised)

        self.rvBtn = QPushButton(self.page)
        self.rvBtn.setObjectName(u"rvBtn")
        self.rvBtn.setGeometry(QRect(780, 260, 101, 71))

        self.frame = QFrame(self.page)
        self.frame.setObjectName(u"frame")
        self.frame.setGeometry(QRect(150, 530, 71, 16))
        self.frame.setAutoFillBackground(True)
        self.frame.setFrameShape(QFrame.Shape.StyledPanel)
        self.frame.setFrameShadow(QFrame.Shadow.Raised)

        self.vvBtn = QPushButton(self.page)
        self.vvBtn.setObjectName(u"vvBtn")
        self.vvBtn.setGeometry(QRect(60, 200, 101, 71))

        self.frame_20 = QFrame(self.page)
        self.frame_20.setObjectName(u"frame_20")
        self.frame_20.setGeometry(QRect(1010, 340, 71, 16))
        self.frame_20.setAutoFillBackground(True)
        self.frame_20.setFrameShape(QFrame.Shape.StyledPanel)
        self.frame_20.setFrameShadow(QFrame.Shadow.Raised)

        self.doorBtn = QPushButton(self.page)
        self.doorBtn.setObjectName(u"doorBtn")
        self.doorBtn.setGeometry(QRect(60, 310, 101, 71))

        self.ms2shutterBtn = QPushButton(self.page)
        self.ms2shutterBtn.setObjectName(u"ms2shutterBtn")
        self.ms2shutterBtn.setGeometry(QRect(480, 600, 101, 71))

        self.frame_15 = QFrame(self.page)
        self.frame_15.setObjectName(u"frame_15")
        self.frame_15.setGeometry(QRect(620, 290, 16, 131))
        self.frame_15.setAutoFillBackground(True)
        self.frame_15.setFrameShape(QFrame.Shape.StyledPanel)
        self.frame_15.setFrameShadow(QFrame.Shadow.Raised)

        self.ms1shutterBtn = QPushButton(self.page)
        self.ms1shutterBtn.setObjectName(u"ms1shutterBtn")
        self.ms1shutterBtn.setGeometry(QRect(60, 600, 101, 71))

        self.frame_12 = QFrame(self.page)
        self.frame_12.setObjectName(u"frame_12")
        self.frame_12.setGeometry(QRect(310, 110, 16, 71))
        self.frame_12.setAutoFillBackground(True)
        self.frame_12.setFrameShape(QFrame.Shape.StyledPanel)
        self.frame_12.setFrameShadow(QFrame.Shadow.Raised)

        self.mainshutterBtn = QPushButton(self.page)
        self.mainshutterBtn.setObjectName(u"mainshutterBtn")
        self.mainshutterBtn.setGeometry(QRect(480, 200, 101, 71))

        self.frame_17 = QFrame(self.page)
        self.frame_17.setObjectName(u"frame_17")
        self.frame_17.setGeometry(QRect(410, 340, 211, 16))
        self.frame_17.setAutoFillBackground(True)
        self.frame_17.setFrameShape(QFrame.Shape.StyledPanel)
        self.frame_17.setFrameShadow(QFrame.Shadow.Raised)

        self.ms1powerBtn = QPushButton(self.page)
        self.ms1powerBtn.setObjectName(u"ms1powerBtn")
        self.ms1powerBtn.setGeometry(QRect(60, 500, 101, 71))

        self.stackedWidget.addWidget(self.page)

        # Raise order (원본 유지)
        self.frame_2.raise_()
        self.frame_19.raise_()
        self.frame_7.raise_()
        self.frame_9.raise_()
        self.frame_8.raise_()
        self.rpBtn.raise_()
        self.frame_13.raise_()
        self.mvBtn.raise_()
        self.frame_6.raise_()
        self.frame_16.raise_()
        self.frame_4.raise_()
        self.frame_3.raise_()
        self.fvBtn.raise_()
        self.frame_5.raise_()
        self.frame_10.raise_()
        self.processBtn.raise_()
        self.frame_18.raise_()
        self.frame_14.raise_()
        self.frame_11.raise_()
        self.rvBtn.raise_()
        self.frame.raise_()
        self.vvBtn.raise_()
        self.frame_20.raise_()
        self.doorBtn.raise_()
        self.ms2shutterBtn.raise_()
        self.frame_15.raise_()
        self.ms1shutterBtn.raise_()
        self.frame_12.raise_()
        self.mainshutterBtn.raise_()
        self.frame_17.raise_()
        self.ms1powerBtn.raise_()
        self.pushButton_13.raise_()
        self.ms2powerBtn.raise_()
        self.ftmBtn.raise_()
        self.widget.raise_()

        self.page_2 = QWidget()
        self.page_2.setObjectName(u"page_2")

        self.materialEdit = QLineEdit(self.page_2)
        self.materialEdit.setObjectName(u"materialEdit")
        self.materialEdit.setGeometry(QRect(10, 140, 181, 26))

        self.graphWidget = QWidget(self.page_2)
        self.graphWidget.setObjectName(u"graphWidget")
        self.graphWidget.setGeometry(QRect(209, 10, 921, 511))
        self.graphWidget.setAutoFillBackground(True)

        self.deprateEdit = QLineEdit(self.page_2)
        self.deprateEdit.setObjectName(u"deprateEdit")
        self.deprateEdit.setGeometry(QRect(10, 200, 181, 26))

        self.powerEdit = QLineEdit(self.page_2)
        self.powerEdit.setObjectName(u"powerEdit")
        self.powerEdit.setGeometry(QRect(10, 260, 181, 26))

        self.thicknessEdit = QLineEdit(self.page_2)
        self.thicknessEdit.setObjectName(u"thicknessEdit")
        self.thicknessEdit.setGeometry(QRect(10, 380, 181, 26))

        self.delayEdit = QLineEdit(self.page_2)
        self.delayEdit.setObjectName(u"delayEdit")
        self.delayEdit.setGeometry(QRect(10, 320, 181, 26))

        self.materialLabel = QLabel(self.page_2)
        self.materialLabel.setObjectName(u"materialLabel")
        self.materialLabel.setGeometry(QRect(10, 120, 181, 20))
        self.materialLabel.setAlignment(Qt.AlignmentFlag.AlignLeading|Qt.AlignmentFlag.AlignLeft|Qt.AlignmentFlag.AlignVCenter)

        self.stopProcess = QPushButton(self.page_2)
        self.stopProcess.setObjectName(u"stopProcess")
        self.stopProcess.setGeometry(QRect(110, 450, 87, 71))

        self.startProcess = QPushButton(self.page_2)
        self.startProcess.setObjectName(u"startProcess")
        self.startProcess.setGeometry(QRect(10, 450, 87, 71))

        self.logWindow = QLineEdit(self.page_2)
        self.logWindow.setObjectName(u"logWindow")
        self.logWindow.setGeometry(QRect(0, 530, 1131, 171))

        self.thicknessLabel = QLabel(self.page_2)
        self.thicknessLabel.setObjectName(u"thicknessLabel")
        self.thicknessLabel.setGeometry(QRect(10, 360, 181, 20))
        self.thicknessLabel.setAlignment(Qt.AlignmentFlag.AlignLeading|Qt.AlignmentFlag.AlignLeft|Qt.AlignmentFlag.AlignVCenter)

        self.delayLabel = QLabel(self.page_2)
        self.delayLabel.setObjectName(u"delayLabel")
        self.delayLabel.setGeometry(QRect(10, 300, 181, 20))
        self.delayLabel.setAlignment(Qt.AlignmentFlag.AlignLeading|Qt.AlignmentFlag.AlignLeft|Qt.AlignmentFlag.AlignVCenter)

        self.pwoerLabel = QLabel(self.page_2)
        self.pwoerLabel.setObjectName(u"pwoerLabel")
        self.pwoerLabel.setGeometry(QRect(10, 240, 181, 20))
        self.pwoerLabel.setAlignment(Qt.AlignmentFlag.AlignLeading|Qt.AlignmentFlag.AlignLeft|Qt.AlignmentFlag.AlignVCenter)

        self.deprateLabel = QLabel(self.page_2)
        self.deprateLabel.setObjectName(u"deprateLabel")
        self.deprateLabel.setGeometry(QRect(10, 180, 181, 20))
        self.deprateLabel.setAlignment(Qt.AlignmentFlag.AlignLeading|Qt.AlignmentFlag.AlignLeft|Qt.AlignmentFlag.AlignVCenter)

        self.evaporatorLabel = QLabel(self.page_2)
        self.evaporatorLabel.setObjectName(u"evaporatorLabel")
        self.evaporatorLabel.setGeometry(QRect(10, 10, 181, 31))
        font = QFont()
        font.setPointSize(19)
        self.evaporatorLabel.setFont(font)
        self.evaporatorLabel.setAlignment(Qt.AlignmentFlag.AlignCenter)

        self.hmiBtn = QPushButton(self.page_2)
        self.hmiBtn.setObjectName(u"hmiBtn")
        self.hmiBtn.setGeometry(QRect(10, 50, 181, 61))

        self.stackedWidget.addWidget(self.page_2)

        self.retranslateUi(Form)

        self.stackedWidget.setCurrentIndex(0)

        QMetaObject.connectSlotsByName(Form)

        # ✅ 위젯 크기 확정된 뒤 커스텀 적용(선 깨짐/배치 붕괴 방지)
        QTimer.singleShot(0, self._apply_custom_ui)

    # setupUi

    def retranslateUi(self, Form):
        Form.setWindowTitle(QCoreApplication.translate("Form", u"Form", None))
        self.pushButton_13.setText(QCoreApplication.translate("Form", u"T . M . P", None))
        self.ms2powerBtn.setText(QCoreApplication.translate("Form", u"M.S 2 Power", None))
        self.ftmBtn.setText(QCoreApplication.translate("Form", u"F . T . M", None))
        self.rpBtn.setText(QCoreApplication.translate("Form", u"R / P", None))
        self.mvBtn.setText(QCoreApplication.translate("Form", u"M / V", None))
        self.fvBtn.setText(QCoreApplication.translate("Form", u"F / V", None))
        self.processBtn.setText(QCoreApplication.translate("Form", u"Process", None))
        self.rvBtn.setText(QCoreApplication.translate("Form", u"R / V", None))
        self.vvBtn.setText(QCoreApplication.translate("Form", u"V / V", None))
        self.doorBtn.setText(QCoreApplication.translate("Form", u"Door", None))
        self.ms2shutterBtn.setText(QCoreApplication.translate("Form", u"M.S 2 Shutter", None))
        self.ms1shutterBtn.setText(QCoreApplication.translate("Form", u"M.S 1 Shutter", None))
        self.mainshutterBtn.setText(QCoreApplication.translate("Form", u"Main Shutter", None))
        self.ms1powerBtn.setText(QCoreApplication.translate("Form", u"M.S 1 Power", None))
        self.materialLabel.setText(QCoreApplication.translate("Form", u"Material Name", None))
        self.stopProcess.setText(QCoreApplication.translate("Form", u"Start", None))
        self.startProcess.setText(QCoreApplication.translate("Form", u"Stop", None))
        self.thicknessLabel.setText(QCoreApplication.translate("Form", u"Thickness", None))
        self.delayLabel.setText(QCoreApplication.translate("Form", u"Delay", None))
        self.pwoerLabel.setText(QCoreApplication.translate("Form", u"Power Ramp (w/s)", None))
        self.deprateLabel.setText(QCoreApplication.translate("Form", u"Dep.Rate", None))
        self.evaporatorLabel.setText(QCoreApplication.translate("Form", u"Evaporator", None))
        self.hmiBtn.setText(QCoreApplication.translate("Form", u"HMI", None))
    # retranslateUi

    # ---------------------------------------------------------------------
    # Manual UI tweak (Chamber-K style)
    # ---------------------------------------------------------------------
    def _apply_custom_ui(self):
        # ===== 챔버K 스타일(QSS) =====  (UI.py에서 가져온 스타일 기반) :contentReference[oaicite:2]{index=2}
        K_TOGGLE_QSS = """
        QPushButton {background: #A0A0A0; color: white; font-weight: bold; font-size: 18pt;
                    border-radius: 8px; border: 2px solid #555555;}
        QPushButton:checked {background: #32FF32; color: black; font-weight: bold; font-size: 18pt;
                            border-radius: 8px; border: 2px solid #229b12;}
        """

        K_DOOR_QSS = """
        QPushButton {
            background: qlineargradient(x1:0, y1:0, x2:0, y2:1, stop:0 #f0f0f0, stop:1 #A0A0A0);
            color: white;
            font-weight: bold; font-size: 18pt;
            border-radius: 20px;
            padding: 8px 0;
            border: 3px solid #555;
        }
        QPushButton:checked {
            background: qlineargradient(x1:0, y1:0, x2:0, y2:1, stop:0 #32FF32, stop:1 #229b12);
            color: black;
        }
        """

        K_ALLSTOP_QSS = """
        QPushButton {background: #A0A0A0; color: red; font-weight: bold; font-size: 18pt;
                    border-radius: 8px; border: 2px solid #555555;}
        QPushButton:pressed {background: #808080; border-color: #333333;}
        """

        # 네비(Process/HMI) = 챔버K의 밝은 버튼 느낌
        K_NAV_QSS = """
        QPushButton {background: #ebebe9; color: black; font-weight: bold; font-size: 14pt;
                    border-radius: 8px; border: 2px solid #cccccc;}
        QPushButton:pressed {background: #dcdcdc;}
        """

        # ===== 중앙 Chamber 위젯 =====
        self.widget.setStyleSheet("background-color: rgb(220, 220, 220); border: none;")
        self._ensure_chamber_label()

        # ===== 버튼들: 챔버K 스타일로 =====
        toggle_buttons = [
            self.vvBtn, self.ftmBtn, self.mainshutterBtn,
            self.ms1powerBtn, self.ms1shutterBtn, self.ms2powerBtn, self.ms2shutterBtn,
            self.rvBtn, self.mvBtn, self.fvBtn, self.rpBtn,
            self.pushButton_13,  # TMP
        ]
        for b in toggle_buttons:
            b.setCheckable(True)
            b.setStyleSheet(K_TOGGLE_QSS)

        # ✅ Door도 다른 버튼과 동일 스타일
        self.doorBtn.setCheckable(True)
        self.doorBtn.setStyleSheet(K_TOGGLE_QSS)

        # Process / HMI는 “일반 버튼” + 밝은 스타일
        self.processBtn.setCheckable(False)
        self.hmiBtn.setCheckable(False)
        self.processBtn.setStyleSheet(K_NAV_QSS)
        self.hmiBtn.setStyleSheet(K_NAV_QSS)

        self._resize_hmi_buttons()
        self._apply_multiline_texts()

        # ✅ Process 버튼을 F.T.M과 같은 높이로 맞춤
        self._align_process_with_ftm()

        self._align_hmi_frames(line_thickness=20)
        self._style_hmi_frames()

        # ✅ 우상단: Air/G1/G2/Water, 우하단: ALL STOP
        self._ensure_top_indicators_and_bottom_allstop()

        # ✅ Chamber 글자 다시 보장(레이아웃 변경 후에도 안 사라지게)
        self._ensure_chamber_label()

    def _ensure_air_water_allstop_kstyle(self):
        # 배치 기준: FTM 높이(y), 우측은 R/P 라인이 닿는 우측선(frame_19) 기준
        ftm_y = self.ftmBtn.geometry().y()
        right_edge = self.frame_19.geometry().right()

        led_d = 36
        gap_led = 18
        gap_stop = 32
        right_margin = 14

        water_x = (right_edge - right_margin) - led_d
        air_x = water_x - gap_led - led_d

        all_w, all_h = 150, 71
        all_x = air_x - gap_stop - all_w
        all_y = ftm_y

        led_y = ftm_y + 8

        # 최초 생성
        if not hasattr(self, "allStopBtn"):
            self.allStopBtn = QPushButton(self.page)
            self.allStopBtn.setText("ALL STOP")
            self.allStopBtn.setCheckable(False)
            self.allStopBtn.setStyleSheet("""
                QPushButton {background: #A0A0A0; color: red; font-weight: bold; font-size: 18pt;
                            border-radius: 8px; border: 2px solid #555555;}
                QPushButton:pressed {background: #808080; border-color: #333333;}
            """)

            # 인디케이터는 QFrame으로(챔버K 방식)
            self.airLed = QFrame(self.page)
            self.waterLed = QFrame(self.page)

            self.airText = QLabel(self.page); self.airText.setText("Air")
            self.waterText = QLabel(self.page); self.waterText.setText("water")

            for lbl in (self.airText, self.waterText):
                lbl.setAlignment(Qt.AlignmentFlag.AlignHCenter | Qt.AlignmentFlag.AlignTop)
                lbl.setStyleSheet("font-weight: bold; font-size: 13pt; color: black;")

            # 초기값 ON(초록)로 보이게(원하면 False로 바꿔서 빨강 초기화 가능)
            self.airLed.setStyleSheet("background: #38d62f; border-radius: 18px; border: 2px solid #333;")
            self.waterLed.setStyleSheet("background: #38d62f; border-radius: 18px; border: 2px solid #333;")

        # 위치 갱신
        self.allStopBtn.setGeometry(all_x, all_y, all_w, all_h)

        self.airLed.setGeometry(air_x, led_y, led_d, led_d)
        self.airText.setGeometry(air_x - 10, led_y + led_d + 4, led_d + 20, 20)

        self.waterLed.setGeometry(water_x, led_y, led_d, led_d)
        self.waterText.setGeometry(water_x - 10, led_y + led_d + 4, led_d + 20, 20)

        # 앞으로
        self.allStopBtn.raise_()
        self.airLed.raise_(); self.airText.raise_()
        self.waterLed.raise_(); self.waterText.raise_()

    def _ensure_air_water_allstop(self):
        """
        요구사항:
        - 상단에 Air/Water 인디케이터 추가
        - 위치: F.T.M과 같은 높이(y), 우측 F/V 버튼 영역 상단(x 기준)
        - All Stop 버튼은 인디케이터 '왼쪽'에 붙여서 배치
        """
        ftm_y = self.ftmBtn.geometry().y()  # y는 F.T.M과 동일

        led_d = 34
        gap_led = 40          # ✅ Air-Water 간격(조금 넓게)
        gap_stop = 40         # ✅ AllStop과 Air 사이 간격(조금 넓게)

        # ✅ 우측 기준: R/P 라인이 나가서 닿는 '우측 외곽선(frame_19)'의 오른쪽 edge
        right_edge = self.frame_19.geometry().right()
        right_margin = 5     # ✅ 기준선 대비 살짝 안쪽으로 (가로 마진)

        # water가 가장 오른쪽
        water_x = (right_edge - right_margin) - led_d
        air_x = water_x - gap_led - led_d

        # All Stop은 Air의 왼쪽에 붙여서
        all_w, all_h = 140, 71
        all_x = air_x - gap_stop - all_w
        all_y = ftm_y

        # y(LED는 버튼 라인에서 살짝 내려서 보기 좋게)
        led_y = ftm_y + 6

        # --- 생성(최초 1회) ---
        if not hasattr(self, "allStopBtn"):
            self.allStopBtn = QPushButton(self.page)
            self.allStopBtn.setObjectName("allStopBtn")
            self.allStopBtn.setText("ALL STOP")
            self.allStopBtn.setStyleSheet("""
                QPushButton{
                    background-color: rgb(180,180,180);
                    color: rgb(200,0,0);
                    border: none;
                    border-radius: 10px;
                    font-weight: 800;
                    font-size: 16px;
                }
                QPushButton:pressed{
                    background-color: rgb(150,150,150);
                }
            """)

            # Air LED + label
            self.airLed = QLabel(self.page)
            self.airLed.setObjectName("airLed")
            self.airText = QLabel(self.page)
            self.airText.setObjectName("airText")
            self.airText.setText("Air")
            self.airText.setAlignment(Qt.AlignmentFlag.AlignHCenter | Qt.AlignmentFlag.AlignTop)

            # Water LED + label
            self.waterLed = QLabel(self.page)
            self.waterLed.setObjectName("waterLed")
            self.waterText = QLabel(self.page)
            self.waterText.setObjectName("waterText")
            self.waterText.setText("Water")
            self.waterText.setAlignment(Qt.AlignmentFlag.AlignHCenter | Qt.AlignmentFlag.AlignTop)

            # 기본 색(원하면 초기값 red로 바꿔도 됨)
            self.airLed.setStyleSheet(f"""
                background-color: rgb(0,200,0);
                border: 2px solid rgb(80,80,80);
                border-radius: {led_d//2}px;
            """)
            self.waterLed.setStyleSheet(f"""
                background-color: rgb(0,200,0);
                border: 2px solid rgb(80,80,80);
                border-radius: {led_d//2}px;
            """)
            self.airText.setStyleSheet("color: rgb(30,30,30); font-weight: 700;")
            self.waterText.setStyleSheet("color: rgb(30,30,30); font-weight: 700;")

        # --- 위치 갱신(항상) ---
        self.allStopBtn.setGeometry(all_x, all_y, all_w, all_h)

        self.airLed.setGeometry(air_x, led_y, led_d, led_d)
        self.airText.setGeometry(air_x - 10, led_y + led_d + 4, led_d + 20, 18)

        self.waterLed.setGeometry(water_x, led_y, led_d, led_d)
        self.waterText.setGeometry(water_x - 10, led_y + led_d + 4, led_d + 20, 18)

        # 프레임이 뒤로 가더라도 얘네는 앞으로 보이게
        self.allStopBtn.raise_()
        self.airLed.raise_()
        self.airText.raise_()
        self.waterLed.raise_()
        self.waterText.raise_()

    def _style_hmi_frames(self):
        # 챔버K 회색 라인 느낌 (#b2b2b2 계열)
        frame_qss = "background-color: #b2b2b2; border: none;"
        frames = [
            self.frame, self.frame_2, self.frame_3, self.frame_4, self.frame_5, self.frame_6,
            self.frame_7, self.frame_8, self.frame_9, self.frame_10, self.frame_11, self.frame_12,
            self.frame_13, self.frame_14, self.frame_15, self.frame_16, self.frame_17,
            self.frame_18, self.frame_19, self.frame_20,
        ]
        for f in frames:
            f.setFrameShape(QFrame.Shape.NoFrame)
            f.setFrameShadow(QFrame.Shadow.Plain)
            f.setStyleSheet(frame_qss)
            f.setAttribute(Qt.WidgetAttribute.WA_TransparentForMouseEvents, True)
            f.lower()  # ✅ 항상 뒤로


    def _align_hmi_frames(self, line_thickness: int = 24):
        """
        선(프레임) 굵기 증가 + 연결 끝점 정렬 + F/V가 세로선(frame_16)과 겹치지 않게 보정
        """
        t = int(line_thickness)
        half = t // 2

        def cx(r: QRect) -> int: return r.x() + r.width() // 2
        def cy(r: QRect) -> int: return r.y() + r.height() // 2

        def set_hline(frame: QFrame, x_left: int, x_right: int, y_center: int):
            if x_right < x_left:
                x_left, x_right = x_right, x_left
            frame.setGeometry(QRect(int(x_left), int(y_center - half), int(x_right - x_left), t))

        def set_vline(frame: QFrame, x_center: int, y_top: int, y_bottom: int):
            if y_bottom < y_top:
                y_top, y_bottom = y_bottom, y_top
            frame.setGeometry(QRect(int(x_center - half), int(y_top), t, int(y_bottom - y_top)))

        # --- 기준 지오메트리 ---
        ch = self.widget.geometry()
        ch_left = ch.left()
        ch_right = ch.right() + 1
        ch_top = ch.top()
        ch_bottom = ch.bottom() + 1

        vv = self.vvBtn.geometry()
        door = self.doorBtn.geometry()
        ftm = self.ftmBtn.geometry()
        main = self.mainshutterBtn.geometry()

        ms1p = self.ms1powerBtn.geometry()
        ms1s = self.ms1shutterBtn.geometry()
        ms2p = self.ms2powerBtn.geometry()
        ms2s = self.ms2shutterBtn.geometry()

        rv = self.rvBtn.geometry()
        mv = self.mvBtn.geometry()
        rp = self.rpBtn.geometry()
        fv = self.fvBtn.geometry()  # ✅ F/V (겹침 보정에 사용)

        y_vv = cy(vv)
        y_door = cy(door)
        y_main = cy(main)

        y_ms1p = cy(ms1p)
        y_ms1s = cy(ms1s)
        y_ms2p = cy(ms2p)
        y_ms2s = cy(ms2s)

        y_rv = cy(rv)
        y_mv = cy(mv)
        y_rp = cy(rp)

        # --- Chamber 아래 4개 수직 바 위치 ---
        w = ch.width()
        bar1_xc = ch_left + int(w * 0.16)
        bar2_xc = ch_left + int(w * 0.33)
        bar3_xc = ch_left + int(w * 0.67)
        bar4_xc = ch_left + int(w * 0.84)

        # 1) V/V, Door -> Chamber 좌측
        set_hline(self.frame_10, vv.right() + 1, ch_left + half, y_vv)
        set_hline(self.frame_7,  door.right() + 1, ch_left + half, y_door)

        # 2) FTM -> Chamber 상단
        set_vline(self.frame_12, cx(ftm), ftm.bottom() + 1, ch_top + half)

        # 3) Chamber 우측 -> Main shutter
        set_hline(self.frame_11, ch_right - half, main.left() + half, y_main)

        # 4) Chamber 아래 -> 수직 바
        set_vline(self.frame_9, bar1_xc, ch_bottom - half, y_ms1p + half)
        set_vline(self.frame_5, bar2_xc, ch_bottom - half, y_ms1s + half)
        set_vline(self.frame_6, bar3_xc, ch_bottom - half, y_ms2s + half)
        set_vline(self.frame_8, bar4_xc, ch_bottom - half, y_ms2p + half)

        # 5) MS1 / MS2 가로 연결
        set_hline(self.frame,   ms1p.right() + 1, bar1_xc + half, y_ms1p)
        set_hline(self.frame_2, ms1s.right() + 1, bar2_xc + half, y_ms1s)
        set_hline(self.frame_3, bar4_xc - half, ms2p.left() + half, y_ms2p)
        set_hline(self.frame_4, bar3_xc - half, ms2s.left() + half, y_ms2s)

        # 6) Chamber -> 오른쪽 루프 연결(y는 Door 라인 레벨 사용)
        y_conn = y_door

        rect_left_xc = cx(self.frame_15.geometry())
        rect_right_xc = cx(self.frame_16.geometry())
        outer_right_xc = cx(self.frame_19.geometry())

        # ✅ 핵심: F/V 버튼이 frame_16(세로선)과 겹치지 않게 “세로선 x를 더 오른쪽”으로 보정
        min_rect_right_xc = fv.right() + 1 + half + 10  # 10px 여유
        rect_right_xc = max(rect_right_xc, min_rect_right_xc)

        # 화면 밖으로 너무 나가면 클램프
        page_w = self.page.width()
        rect_right_xc = min(rect_right_xc, page_w - 20 - half)

        # outer loop도 rect_right보다 오른쪽 유지
        outer_right_xc = max(outer_right_xc, rect_right_xc + 40)
        outer_right_xc = min(outer_right_xc, page_w - 10 - half)

        # Chamber -> rect_left
        set_hline(self.frame_17, ch_right - half, rect_left_xc + half, y_conn)

        # 내부 사각 RV~MV
        set_vline(self.frame_15, rect_left_xc,  y_rv - half, y_mv + half)
        set_vline(self.frame_16, rect_right_xc, y_rv - half, y_mv + half)
        set_hline(self.frame_14, rect_left_xc - half, rect_right_xc + half, y_rv)
        set_hline(self.frame_13, rect_left_xc - half, rect_right_xc + half, y_mv)

        # 외곽 루프 + RP 연결
        set_hline(self.frame_20, rect_right_xc - half, outer_right_xc + half, y_conn)
        set_vline(self.frame_19, outer_right_xc, y_conn - half, y_rp + half)
        set_hline(self.frame_18, rp.right() + 1, outer_right_xc + half, y_rp)


    def _ensure_chamber_label(self):
        if getattr(self, "_chamberLabel", None) is None:
            self._chamberLabel = QLabel(self.widget)
            self._chamberLabel.setText("Chamber")
            self._chamberLabel.setAlignment(Qt.AlignmentFlag.AlignCenter)
            f = QFont()
            f.setPointSize(22)
            f.setBold(True)
            self._chamberLabel.setFont(f)
            self._chamberLabel.setStyleSheet("background: transparent; color: rgb(90, 90, 90);")
        self._chamberLabel.setGeometry(QRect(0, 0, self.widget.width(), self.widget.height()))
        self._chamberLabel.raise_()

    def _normalize_hmi_vertical_margins(self):
        """
        HMI 페이지(page)에서 모든 요소를 동일한 delta로 이동시켜
        상단 여백과 하단 여백을 같게 맞춘다.
        """
        # HMI 화면에서 같이 움직여야 하는 것들(버튼/챔버/프레임/상단 요소들)
        frames = [
            self.frame, self.frame_2, self.frame_3, self.frame_4, self.frame_5, self.frame_6,
            self.frame_7, self.frame_8, self.frame_9, self.frame_10, self.frame_11, self.frame_12,
            self.frame_13, self.frame_14, self.frame_15, self.frame_16, self.frame_17,
            self.frame_18, self.frame_19, self.frame_20,
        ]
        widgets = [
            self.processBtn, self.ftmBtn, self.vvBtn, self.doorBtn, self.mainshutterBtn,
            self.ms1powerBtn, self.ms1shutterBtn, self.ms2powerBtn, self.ms2shutterBtn,
            self.rvBtn, self.mvBtn, self.fvBtn, self.rpBtn, self.pushButton_13,
            self.widget,
        ]
        # 상단 All Stop / Air / Water가 있으면 포함
        for name in ("allStopBtn", "airLed", "airText", "waterLed", "waterText"):
            if hasattr(self, name):
                widgets.append(getattr(self, name))

        items = frames + widgets

        # 현재 top/bottom margin 계산
        min_y = min(w.geometry().top() for w in items)
        max_y = max(w.geometry().bottom() for w in items)
        page_h = self.page.height()
        # setupUi 시점에 page.height()가 0/작게 잡히는 경우가 있어 과이동 발생 → fallback
        if page_h < 50:
            page_h = self.stackedWidget.height()  # stackedWidget은 geometry를 이미 가지고 있음

        top_margin = min_y
        bottom_margin = page_h - (max_y + 1)

        # 목표 이동량(기존과 동일한 계산)
        d0 = (top_margin - bottom_margin) // 2
        if d0 == 0:
            return

        # 최소 상/하 여백(원하는 값으로 조절 가능)
        min_top = 20
        min_bottom = 20

        # d는 다음 조건을 만족해야 함:
        # new_top = top_margin - d >= min_top  -> d <= top_margin - min_top
        # new_bottom = bottom_margin + d >= min_bottom -> d >= min_bottom - bottom_margin
        d_min = min_bottom - bottom_margin
        d_max = top_margin - min_top

        # 만족 불가능하면(이미 꽉 차있는 경우) 이동하지 않음
        if d_max < d_min:
            return

        # d0를 안전 범위로 clamp
        d = max(d_min, min(d0, d_max))
        if d == 0:
            return

        for w in items:
            g = w.geometry()
            w.setGeometry(g.translated(0, -d))

    def _resize_hmi_buttons(self):
        """HMI 페이지 버튼 크기 키우되, 중심점은 그대로 유지"""
        def resize_keep_center(btn: QPushButton, w: int, h: int):
            g = btn.geometry()
            cx = g.x() + g.width() // 2
            cy = g.y() + g.height() // 2
            btn.setGeometry(cx - w // 2, cy - h // 2, w, h)

        # 기본 토글 버튼(밸브/펌프 등)
        base = [self.vvBtn, self.ftmBtn, self.rvBtn, self.mvBtn, self.fvBtn, self.rpBtn, self.pushButton_13]
        for b in base:
            resize_keep_center(b, 120, 78)

        # 텍스트 긴 버튼(셔터/파워/메인셔터) 더 넓게
        long_btns = [self.mainshutterBtn, self.ms1powerBtn, self.ms1shutterBtn, self.ms2powerBtn, self.ms2shutterBtn]
        for b in long_btns:
            resize_keep_center(b, 135, 82)

        # Door도 동일 사이즈로(스타일은 위에서 동일 토글로 바꿈)
        resize_keep_center(self.doorBtn, 120, 78)

        # Process는 지금처럼 일반 버튼 유지(원하면 같이 키워도 됨)
        resize_keep_center(self.processBtn, 120, 78)


    def _apply_multiline_texts(self):
        """긴 텍스트를 2줄로 바꿔서 잘림 방지(translate 이후 실행이라 안전)"""
        self.mainshutterBtn.setText("Main\nShutter")
        self.ms1powerBtn.setText("M.S 1\nPower")
        self.ms1shutterBtn.setText("M.S 1\nShutter")
        self.ms2powerBtn.setText("M.S 2\nPower")
        self.ms2shutterBtn.setText("M.S 2\nShutter")

    def _align_process_with_ftm(self):
        """Process 버튼 top을 F.T.M 버튼 top과 동일하게"""
        g = self.processBtn.geometry()
        target_y = self.ftmBtn.geometry().y()
        self.processBtn.setGeometry(g.x(), target_y, g.width(), g.height())
        self.processBtn.raise_()

    def _ensure_top_indicators_and_bottom_allstop(self):
        """
        요구사항:
        - 우상단: Air, G1, G2, Water (총 4개)
        - 우하단: ALL STOP
        """
        # ---- 스타일(챔버K 느낌 유지) ----
        LED_ON = "background: #38d62f; border-radius: 18px; border: 2px solid #333;"
        LED_OFF = "background: #d82c2c; border-radius: 18px; border: 2px solid #333;"
        ALLSTOP_QSS = """
            QPushButton {background: #A0A0A0; color: red; font-weight: bold; font-size: 18pt;
                        border-radius: 8px; border: 2px solid #555555;}
            QPushButton:pressed {background: #808080; border-color: #333333;}
        """

        page_w = self.page.width()
        page_h = self.page.height()

        margin = 22

        # ---- (1) 우상단 인디케이터 4개 ----
        led_d = 36
        gap = 18
        label_h = 20
        top_y = margin

        names = ["Air", "G1", "G2", "water"]  # 챔버K 표기 참고(원하면 Water로 바꿔도 됨)
        total_w = led_d * 4 + gap * 3
        start_x = page_w - margin - total_w

        # 최초 생성
        if not hasattr(self, "indLeds"):
            self.indLeds = {}
            self.indTexts = {}
            for name in names:
                led = QFrame(self.page)
                txt = QLabel(self.page)
                txt.setText(name)
                txt.setAlignment(Qt.AlignmentFlag.AlignHCenter | Qt.AlignmentFlag.AlignTop)
                txt.setStyleSheet("font-weight: bold; font-size: 13pt; color: black;")
                # 초기 ON(초록)로 표시
                led.setStyleSheet(LED_ON)

                self.indLeds[name] = led
                self.indTexts[name] = txt

        # 위치 갱신
        for i, name in enumerate(names):
            x = start_x + i * (led_d + gap)
            self.indLeds[name].setGeometry(x, top_y, led_d, led_d)
            self.indTexts[name].setGeometry(x - 10, top_y + led_d + 4, led_d + 20, label_h)

        # ---- (2) 우하단 ALL STOP ----
        btn_w, btn_h = 190, 90
        x_btn = page_w - margin - btn_w
        y_btn = page_h - margin - btn_h

        if not hasattr(self, "allStopBtn"):
            self.allStopBtn = QPushButton(self.page)
            self.allStopBtn.setText("ALL STOP")
            self.allStopBtn.setCheckable(False)
            self.allStopBtn.setStyleSheet(ALLSTOP_QSS)

        self.allStopBtn.setGeometry(x_btn, y_btn, btn_w, btn_h)

        # ---- 앞으로 ----
        for name in names:
            self.indLeds[name].raise_()
            self.indTexts[name].raise_()
        self.allStopBtn.raise_()

